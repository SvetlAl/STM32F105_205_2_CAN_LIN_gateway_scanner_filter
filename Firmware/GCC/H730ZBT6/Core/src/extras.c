//*****************************************************************
// 
//
//	TEST FUNCTIONS
//
//
//*****************************************************************

#include "device_model.h"
#include "extras.h"

#ifdef SUPPORT_FDCAN
#include "FDCAN/fdcan.h"
#include "FDCAN/fdcan_macros.h"
#endif


#ifdef TEST_SPEED_TRANSMITTER

static const uint32_t PCKT_CNT_TO_SEND = 500;
static uint32_t injection_counter = 0x0000;
static const uint32_t MSG_PCK_SIZE = 21;




static can_message LC300_SPD_ODO_0D7;
static can_message LC300_SPD_ODO_0D8;
static can_message LC300_CRS_399;
static uint8_t LC300_ODO = 0;

static can_message LC150_SPD_ODO_0B4;
static can_message LC150_SPD_ODO_0B5;
static uint8_t LC150_ODO = 0;
static can_message GW_SPD_SPD_265;
	
static can_message DODGE_SPD_11C;
static can_message DODGE_ODO_278;
	
static uint8_t DODGE_ODO = 0;
	
static can_message ISUZU_SPD_ODO_141;
static can_message ISUZU_CRS_46C;
	
static can_message LR_SPD_ODO_011;
static can_message LR_CRS_150;
	
	
static can_message MMC_SPD_ODO_214;
static can_message MMC_SPD_ODO_215;
	
static can_message GW_POER_SPD_SPD_266;
static can_message GW_POER_CRS_271;
static can_message GW_POER_TYRES_ERR_341;
static can_message GW_POER_TYRES_395;
	
static uint8_t POER_ODO1 = 0;
static uint8_t POER_ODO2 = 0;
	
static can_message  MMC_ACC_101;
static can_message  MMC_ACC_22B;
#endif

void init_extras(){
	
	#if (defined(TEST_SPEED_TRANSMITTER) | defined(TEST_SPEED_RESPONDER)) & defined(BOARD_MK_STM32F105)
		// LED A
	GPIOA->CRL	&= ~GPIO_CRL_CNF3;						
	GPIOA->CRL 	|= GPIO_CRL_MODE3_0;					
	GPIOA->CRL 	|= GPIO_CRL_MODE3_1;
	GPIOA->BSRR |= GPIO_BSRR_BR3;						
	// LED B	
	GPIOC->CRH	&= ~GPIO_CRH_CNF11;					
	GPIOC->CRH 	|= GPIO_CRH_MODE11_0;				
	GPIOC->CRH 	|= GPIO_CRH_MODE11_1;
	GPIOC->BSRR |= GPIO_BSRR_BR11;
	#endif
	
	
	#ifdef TEST_SPEED_TRANSMITTER

	LC300_SPD_ODO_0D8.id.std_id.id_highbyte=0x00;
	LC300_SPD_ODO_0D8.id.std_id.id_lowbyte=0xD8;
	LC300_SPD_ODO_0D8.dlc=8;
	LC300_SPD_ODO_0D8.data[0]=LC300_ODO ;
	LC300_SPD_ODO_0D8.data[1]=0x1A;
	LC300_SPD_ODO_0D8.data[2]=0x1A;
	LC300_SPD_ODO_0D8.data[3]=0x1A;
	LC300_SPD_ODO_0D8.data[4]=0x1A;
	LC300_SPD_ODO_0D8.data[5]=0x1A;
	LC300_SPD_ODO_0D8.data[6]=0x1A;
	LC300_SPD_ODO_0D8.data[7]=0x1A;
	
	LC300_CRS_399.id.std_id.id_highbyte=0x3;
	LC300_CRS_399.id.std_id.id_lowbyte=0x99;
	LC300_CRS_399.dlc=8;
	LC300_CRS_399.data[0]=0x1A ;
	LC300_CRS_399.data[1]=0x1A;
	LC300_CRS_399.data[2]=0x1A;
	LC300_CRS_399.data[3]=0x1A;
	LC300_CRS_399.data[4]=0x1A;
	LC300_CRS_399.data[5]=0x1A;
	LC300_CRS_399.data[6]=0x1A;
	LC300_CRS_399.data[7]=0x1A;
	
	LC300_SPD_ODO_0D7.id.std_id.id_highbyte=0x00;
	LC300_SPD_ODO_0D7.id.std_id.id_lowbyte=0xD7;
	LC300_SPD_ODO_0D7.dlc=8;
	LC300_SPD_ODO_0D7.data[0]=LC300_ODO ;
	LC300_SPD_ODO_0D7.data[1]=0x1A;
	LC300_SPD_ODO_0D7.data[2]=0x1A;
	LC300_SPD_ODO_0D7.data[3]=0x1A;
	LC300_SPD_ODO_0D7.data[4]=0x1A;
	LC300_SPD_ODO_0D7.data[5]=0x1A;
	LC300_SPD_ODO_0D7.data[6]=0x1A;
	LC300_SPD_ODO_0D7.data[7]=0x1A;

	LC150_SPD_ODO_0B4.id.std_id.id_highbyte=0x0;
	LC150_SPD_ODO_0B4.id.std_id.id_lowbyte=0xB4;
	LC150_SPD_ODO_0B4.dlc=8;
	LC150_SPD_ODO_0B4.data[0]=0x1A ;
	LC150_SPD_ODO_0B4.data[1]=0x1A;
	LC150_SPD_ODO_0B4.data[2]=0x1A;
	LC150_SPD_ODO_0B4.data[3]=0x1A;
	LC150_SPD_ODO_0B4.data[4]=LC150_ODO;
	LC150_SPD_ODO_0B4.data[5]=0x1A;
	LC150_SPD_ODO_0B4.data[6]=0x1A;
	LC150_SPD_ODO_0B4.data[7]=0x1A;
	
	LC150_SPD_ODO_0B5.id.std_id.id_highbyte=0x0;
	LC150_SPD_ODO_0B5.id.std_id.id_lowbyte=0xB5;
	LC150_SPD_ODO_0B5.dlc=8;
	LC150_SPD_ODO_0B5.data[0]=0x1A ;
	LC150_SPD_ODO_0B5.data[1]=0x1A;
	LC150_SPD_ODO_0B5.data[2]=0x1A;
	LC150_SPD_ODO_0B5.data[3]=0x1A;
	LC150_SPD_ODO_0B5.data[4]=LC150_ODO;
	LC150_SPD_ODO_0B5.data[5]=0x1A;
	LC150_SPD_ODO_0B5.data[6]=0x1A;
	LC150_SPD_ODO_0B5.data[7]=0x1A;

	GW_SPD_SPD_265.id.std_id.id_highbyte=0x2;
	GW_SPD_SPD_265.id.std_id.id_lowbyte=0x65;
	GW_SPD_SPD_265.dlc=8;
	GW_SPD_SPD_265.data[0]=0x3A ;
	GW_SPD_SPD_265.data[1]=0x3A;
	GW_SPD_SPD_265.data[2]=0x3A;
	GW_SPD_SPD_265.data[3]=POER_ODO1;
	GW_SPD_SPD_265.data[4]=POER_ODO2;
	GW_SPD_SPD_265.data[5]=0x3A;
	GW_SPD_SPD_265.data[6]=0x3A;
	GW_SPD_SPD_265.data[7]=0x3A;
	
	GW_POER_SPD_SPD_266.id.std_id.id_highbyte=0x2;
	GW_POER_SPD_SPD_266.id.std_id.id_lowbyte=0x66;
	GW_POER_SPD_SPD_266.dlc=8;
	GW_POER_SPD_SPD_266.data[0]=0x3A ;
	GW_POER_SPD_SPD_266.data[1]=0x3A;
	GW_POER_SPD_SPD_266.data[2]=0x3A;
	GW_POER_SPD_SPD_266.data[3]=POER_ODO1;
	GW_POER_SPD_SPD_266.data[4]=POER_ODO2;
	GW_POER_SPD_SPD_266.data[5]=0x3A;
	GW_POER_SPD_SPD_266.data[6]=0x3A;
	GW_POER_SPD_SPD_266.data[7]=0x3A;

	GW_POER_CRS_271.id.std_id.id_highbyte=0x2;
	GW_POER_CRS_271.id.std_id.id_lowbyte=0x71;
	GW_POER_CRS_271.dlc=8;
	GW_POER_CRS_271.data[0]=0x00 ;
	GW_POER_CRS_271.data[1]=0x00;
	GW_POER_CRS_271.data[2]=0x00;
	GW_POER_CRS_271.data[3]=0x00;
	GW_POER_CRS_271.data[4]=0x00;
	GW_POER_CRS_271.data[5]=0x3A;
	GW_POER_CRS_271.data[6]=0x3A;
	GW_POER_CRS_271.data[7]=0x00;
	
	GW_POER_TYRES_395.id.std_id.id_highbyte=0x3;
	GW_POER_TYRES_395.id.std_id.id_lowbyte=0x95;
	GW_POER_TYRES_395.dlc=8;
	GW_POER_TYRES_395.data[0]=0x00 ;
	GW_POER_TYRES_395.data[1]=0x00;
	GW_POER_TYRES_395.data[2]=0xB9;
	GW_POER_TYRES_395.data[3]=0xB9;
	GW_POER_TYRES_395.data[4]=0xB9;
	GW_POER_TYRES_395.data[5]=0xB9;
	GW_POER_TYRES_395.data[6]=0x00;
	GW_POER_TYRES_395.data[7]=0x00;	
	
	GW_POER_TYRES_ERR_341.id.std_id.id_highbyte=0x3;
	GW_POER_TYRES_ERR_341.id.std_id.id_lowbyte=0x41;
	GW_POER_TYRES_ERR_341.dlc=8;
	GW_POER_TYRES_ERR_341.data[0]=0x00 ;
	GW_POER_TYRES_ERR_341.data[1]=0x00;
	GW_POER_TYRES_ERR_341.data[2]=0x00;
	GW_POER_TYRES_ERR_341.data[3]=0x00;
	GW_POER_TYRES_ERR_341.data[4]=0x00;
	GW_POER_TYRES_ERR_341.data[5]=0x00;
	GW_POER_TYRES_ERR_341.data[6]=0x00;
	GW_POER_TYRES_ERR_341.data[7]=0x00;

	DODGE_SPD_11C.id.std_id.id_highbyte=0x1;
	DODGE_SPD_11C.id.std_id.id_lowbyte=0x1C;
	DODGE_SPD_11C.dlc=8;
	DODGE_SPD_11C.data[0]=0x1A ;
	DODGE_SPD_11C.data[1]=0x1A;
	DODGE_SPD_11C.data[2]=0x1A;
	DODGE_SPD_11C.data[3]=0x1A;
	DODGE_SPD_11C.data[4]=0x1A;
	DODGE_SPD_11C.data[5]=0x1A;
	DODGE_SPD_11C.data[6]=0x1A;
	DODGE_SPD_11C.data[7]=0x1A;
	
	DODGE_ODO_278.id.std_id.id_highbyte=0x02;
	DODGE_ODO_278.id.std_id.id_lowbyte=0x78;
	DODGE_ODO_278.dlc=8;
	DODGE_ODO_278.data[0]=DODGE_ODO ;
	DODGE_ODO_278.data[1]=0x1A;
	DODGE_ODO_278.data[2]=0x1A;
	DODGE_ODO_278.data[3]=0x1A;
	DODGE_ODO_278.data[4]=0x1A;
	DODGE_ODO_278.data[5]=0x1A;
	DODGE_ODO_278.data[6]=0x1A;
	DODGE_ODO_278.data[7]=0x1A;
	
	ISUZU_SPD_ODO_141.id.std_id.id_highbyte=0x1;
	ISUZU_SPD_ODO_141.id.std_id.id_lowbyte=0x41;
	ISUZU_SPD_ODO_141.dlc=8;
	ISUZU_SPD_ODO_141.data[0]=0x1A ;
	ISUZU_SPD_ODO_141.data[1]=0x1A;
	ISUZU_SPD_ODO_141.data[2]=0x1A;
	ISUZU_SPD_ODO_141.data[3]=0x1A;
	ISUZU_SPD_ODO_141.data[4]=0x1A;
	ISUZU_SPD_ODO_141.data[5]=0x1A;
	ISUZU_SPD_ODO_141.data[6]=0x1A;
	ISUZU_SPD_ODO_141.data[7]=0x1A;
	
	ISUZU_CRS_46C.id.std_id.id_highbyte=0x4;
	ISUZU_CRS_46C.id.std_id.id_lowbyte=0x6C;
	ISUZU_CRS_46C.dlc=8;
	ISUZU_CRS_46C.data[0]=0x11 ;
	ISUZU_CRS_46C.data[1]=0x1A;
	ISUZU_CRS_46C.data[2]=0x1A;
	ISUZU_CRS_46C.data[3]=0x1A;
	ISUZU_CRS_46C.data[4]=0x1A;
	ISUZU_CRS_46C.data[5]=0x1A;
	ISUZU_CRS_46C.data[6]=0x1A;
	ISUZU_CRS_46C.data[7]=0x1A;
	
	LR_SPD_ODO_011.id.std_id.id_highbyte=0x0;
	LR_SPD_ODO_011.id.std_id.id_lowbyte=0x11;
	LR_SPD_ODO_011.dlc=8;
	LR_SPD_ODO_011.data[0]=0x1A ;
	LR_SPD_ODO_011.data[1]=0x1A;
	LR_SPD_ODO_011.data[2]=0x1A;
	LR_SPD_ODO_011.data[3]=0x1A;
	LR_SPD_ODO_011.data[4]=0x1A;
	LR_SPD_ODO_011.data[5]=0x1A;
	LR_SPD_ODO_011.data[6]=0x1A;
	LR_SPD_ODO_011.data[7]=0x1A;
	
	LR_CRS_150.id.std_id.id_highbyte=0x1;
	LR_CRS_150.id.std_id.id_lowbyte=0x50;
	LR_CRS_150.dlc=8;
	LR_CRS_150.data[0]=0x1A ;
	LR_CRS_150.data[1]=0x1A;
	LR_CRS_150.data[2]=0x1A;
	LR_CRS_150.data[3]=0x1A;
	LR_CRS_150.data[4]=0x1A;
	LR_CRS_150.data[5]=0x1A;
	LR_CRS_150.data[6]=0x1A;
	LR_CRS_150.data[7]=0x1A;
	
	MMC_SPD_ODO_214.id.std_id.id_highbyte=0x2;
	MMC_SPD_ODO_214.id.std_id.id_lowbyte=0x14;
	MMC_SPD_ODO_214.dlc=8;
	MMC_SPD_ODO_214.data[0]=0x1A ;
	MMC_SPD_ODO_214.data[1]=0x1A;
	MMC_SPD_ODO_214.data[2]=0x1A;
	MMC_SPD_ODO_214.data[3]=0x1A;
	MMC_SPD_ODO_214.data[4]=0x1A;
	MMC_SPD_ODO_214.data[5]=0x1A;
	MMC_SPD_ODO_214.data[6]=0x1A;
	MMC_SPD_ODO_214.data[7]=0x1A;
	
	MMC_SPD_ODO_215.id.std_id.id_highbyte=0x2;
	MMC_SPD_ODO_215.id.std_id.id_lowbyte=0x15;
	MMC_SPD_ODO_215.dlc=8;
	MMC_SPD_ODO_215.data[0]=0x1A ;
	MMC_SPD_ODO_215.data[1]=0x1A;
	MMC_SPD_ODO_215.data[2]=0x1A;
	MMC_SPD_ODO_215.data[3]=0x1A;
	MMC_SPD_ODO_215.data[4]=0x1A;
	MMC_SPD_ODO_215.data[5]=0x1A;
	MMC_SPD_ODO_215.data[6]=0x1A;
	MMC_SPD_ODO_215.data[7]=0x1A;
	
	MMC_ACC_101.id.std_id.id_highbyte=0x1;
	MMC_ACC_101.id.std_id.id_lowbyte=0x01;
	MMC_ACC_101.dlc=8;
	MMC_ACC_101.data[0]=0x01 ;
	MMC_ACC_101.data[1]=0x00;
	MMC_ACC_101.data[2]=0x00;
	MMC_ACC_101.data[3]=0x00;
	MMC_ACC_101.data[4]=0x00;
	MMC_ACC_101.data[5]=0x00;
	MMC_ACC_101.data[6]=0x00;
	MMC_ACC_101.data[7]=0x00;
	
	MMC_ACC_22B.id.std_id.id_highbyte=0x2;
	MMC_ACC_22B.id.std_id.id_lowbyte=0x2B;
	MMC_ACC_22B.dlc=8;
	MMC_ACC_22B.data[0]=0x00 ;
	MMC_ACC_22B.data[1]=0x1A;
	MMC_ACC_22B.data[2]=0x1A;
	MMC_ACC_22B.data[3]=0x1A;
	MMC_ACC_22B.data[4]=0x00;
	MMC_ACC_22B.data[5]=0x00;
	MMC_ACC_22B.data[6]=0x00;
	MMC_ACC_22B.data[7]=0x00;
	#endif
}

void process_extra_transmission(void){
	#ifdef TEST_SPEED_TRANSMITTER
	//while(timeout--){}
	
	LC300_SPD_ODO_0D7.data[0]=LC300_ODO ;
	LC300_SPD_ODO_0D8.data[0]=LC300_ODO ;
	SIGNAL_LED_B_ON;

	if(Can_Transmit_Message(CAN1, &LC300_SPD_ODO_0D7)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}	

	if(Can_Transmit_Message(CAN1, &LC300_SPD_ODO_0D8)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}
	SIGNAL_LED_B_OFF;
	if(LC300_ODO >= 0x3E) LC300_ODO = 0;
	else LC300_ODO++;


	LC150_SPD_ODO_0B4.data[4]=LC150_ODO;
	LC150_SPD_ODO_0B5.data[4]=LC150_ODO;
	SIGNAL_LED_B_ON;	
	if(Can_Transmit_Message(CAN1, &LC300_CRS_399)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}
	SIGNAL_LED_B_OFF;

				
	SIGNAL_LED_B_ON;					
	if(Can_Transmit_Message(CAN1, &LC150_SPD_ODO_0B4)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}
	SIGNAL_LED_B_OFF;

				
	SIGNAL_LED_B_ON;
	if(Can_Transmit_Message(CAN1, &LC150_SPD_ODO_0B5)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}			
	SIGNAL_LED_B_OFF;
	LC150_ODO+=0x04;
	

					
	GW_SPD_SPD_265.data[3]=POER_ODO1;
	GW_SPD_SPD_265.data[4]=POER_ODO2;
	SIGNAL_LED_B_ON;
	if(Can_Transmit_Message(CAN1, &GW_POER_CRS_271)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}
	SIGNAL_LED_B_OFF;

	SIGNAL_LED_B_ON;
	if(Can_Transmit_Message(CAN1, &GW_SPD_SPD_265)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}
	SIGNAL_LED_B_OFF;
				

					
	GW_POER_SPD_SPD_266.data[3]=POER_ODO1; GW_POER_SPD_SPD_266.data[4]=POER_ODO2;
	SIGNAL_LED_B_ON;
	if(Can_Transmit_Message(CAN1, &GW_POER_SPD_SPD_266)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}
	SIGNAL_LED_B_OFF;
				

					
	SIGNAL_LED_B_ON;
	if(Can_Transmit_Message(CAN1, &GW_POER_TYRES_ERR_341)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}
	SIGNAL_LED_B_OFF;
				
	SIGNAL_LED_B_ON;

	if(Can_Transmit_Message(CAN1, &GW_POER_TYRES_395)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}
	SIGNAL_LED_B_OFF;

	POER_ODO2++;
	if(POER_ODO2 == 0x00) POER_ODO1++;
	if(POER_ODO1 == 0x04)  POER_ODO1 = 0x00;
	DODGE_ODO_278.data[0]=DODGE_ODO ;

	SIGNAL_LED_B_ON;
	if(Can_Transmit_Message(CAN1, &DODGE_SPD_11C)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}		
	SIGNAL_LED_B_OFF;				

	SIGNAL_LED_B_ON;
	if(Can_Transmit_Message(CAN1, &DODGE_ODO_278)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}
	SIGNAL_LED_B_OFF;
	DODGE_ODO++;

	SIGNAL_LED_B_ON;
	if(Can_Transmit_Message(CAN1, &ISUZU_SPD_ODO_141)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}	
	SIGNAL_LED_B_OFF;

	SIGNAL_LED_B_ON;
	if(Can_Transmit_Message(CAN1, &ISUZU_CRS_46C)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}

	SIGNAL_LED_B_OFF;
				
					
					// Additional
					/*
				SIGNAL_LED_B_ON;	
				if(Can_Transmit_Message(CAN1, &LC300_CRS_399)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}
				SIGNAL_LED_B_OFF;
				timeout = transmit_timeout; while(timeout--){}
					*/
					
				
	SIGNAL_LED_B_ON;
	if(Can_Transmit_Message(CAN1, &LR_SPD_ODO_011)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}	
	SIGNAL_LED_B_OFF;				

	SIGNAL_LED_B_ON;
	if(Can_Transmit_Message(CAN1, &LR_CRS_150)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}
	SIGNAL_LED_B_OFF;

	SIGNAL_LED_B_ON;
	if(Can_Transmit_Message(CAN1, &MMC_SPD_ODO_214)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}	
	SIGNAL_LED_B_OFF;				

	SIGNAL_LED_B_ON;
	if(Can_Transmit_Message(CAN1, &MMC_SPD_ODO_215)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}
	SIGNAL_LED_B_OFF;
	
	SIGNAL_LED_B_ON;

	if(Can_Transmit_Message(CAN1, &MMC_ACC_22B)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}
	//timeout = transmit_timeout;while(timeout--){}			
	SIGNAL_LED_B_OFF;
		
	SIGNAL_LED_B_ON;

	if(Can_Transmit_Message(CAN1, &MMC_ACC_101)!=ERR_CAN_NO_EMPTY_MAILBOX){IWDG_reset();}
	SIGNAL_LED_B_OFF;
	#endif
}




	
void calculate_cnt_and_transmit(){
	#ifdef TEST_SPEED_TRANSMITTER
	
	if(check_free_buffer_size(CAN1_BUF_NUM) < MSG_PCK_SIZE){
		return;
	}
	
	else if(injection_counter > 0){
		injection_counter--;
		process_extra_transmission();
	}
	#endif
}

void check_test_transmission_request(){
	#ifdef TEST_SPEED_TRANSMITTER
	static volatile uint32_t _ready = 0;
	static volatile uint32_t theMode = 0;
	
	if((GPIOA->IDR & GPIO_IDR_IDR10)){
		_ready = 0x01;
	}	
	if((!(GPIOA->IDR & GPIO_IDR_IDR10)) & _ready & (injection_counter == 0)){
		_ready = 0x00;
		theMode = 0x01;
	}
	if(theMode  & (injection_counter == 0)){
		//TOTAL_RX_MSGS = 0;
		//secs = 0;
		injection_counter = PCKT_CNT_TO_SEND;
		theMode = 0x00;
	}
	#endif
}






#ifdef PRZRK_DEBUG
#include <string.h>

static u_fdcan_message_hdr TANK500_msg_hdr;
static u_fdcan_message_hdr TANK500_st_msg_hdr;

static uint32_t send_TANK500_st_msg(uint8_t can_num, uint32_t id, uint8_t dlc, uint8_t *data){
	fdcan_message_hdr *_hdr = &TANK500_st_msg_hdr.msg_hdr;
	//FDCAN_SET_MSG_BRS(_hdr, FDCAN_FLAG_SET);
	//FDCAN_SET_MSG_FDF(_hdr, FDCAN_FLAG_SET);
	_hdr->dlc = dlc;
	_hdr->id = id;
	
	uint8_t data_length = FDCAN_MSG_LENGTH(_hdr);
	uint16_t total_length = data_length + sizeof(fdcan_message_hdr);
	
	uint16_t lock_sts = FDCAN_BUFFER_STS_FAIL;
	
	if(fdcan_get_buf_freesize(FDCAN_TX_BUF_PTR(can_num)) >= FDCAN_BUFFER_MAX_ITEM_SZ){
			lock_sts = fdcan_buf_w_lock(FDCAN_TX_BUF_PTR(can_num));
	}
	if(lock_sts != FDCAN_BUFFER_STS_FAIL){
		memcpy(FDCAN_TX_BUF_W_POS_PTR(can_num), &TANK500_st_msg_hdr.data[0], sizeof(fdcan_message_hdr));
		memcpy((FDCAN_TX_BUF_W_POS_PTR(can_num) + sizeof(fdcan_message_hdr)), data, data_length);
		
		fdcan_mov_w_idx(FDCAN_TX_BUF_PTR(can_num), total_length);
		fdcan_buf_w_unlock(FDCAN_TX_BUF_PTR(can_num));
		return id;
	}
	else return 0;
}


static uint32_t send_TANK500_msg(uint8_t can_num, uint32_t id, uint8_t dlc, uint8_t *data){
	fdcan_message_hdr *_hdr = &TANK500_msg_hdr.msg_hdr;
	FDCAN_SET_MSG_BRS(_hdr, FDCAN_FLAG_SET);
	FDCAN_SET_MSG_FDF(_hdr, FDCAN_FLAG_SET);
	_hdr->dlc = dlc;
	_hdr->id = id;
	
	uint8_t data_length = FDCAN_MSG_LENGTH(_hdr);
	uint16_t total_length = data_length + sizeof(fdcan_message_hdr);
	
	uint16_t lock_sts = FDCAN_BUFFER_STS_FAIL;
	
	if(fdcan_get_buf_freesize(FDCAN_TX_BUF_PTR(can_num)) >= FDCAN_BUFFER_MAX_ITEM_SZ){
			lock_sts = fdcan_buf_w_lock(FDCAN_TX_BUF_PTR(can_num));
	}
	if(lock_sts != FDCAN_BUFFER_STS_FAIL){
		memcpy(FDCAN_TX_BUF_W_POS_PTR(can_num), &TANK500_msg_hdr.data[0], sizeof(fdcan_message_hdr));
		memcpy((FDCAN_TX_BUF_W_POS_PTR(can_num) + sizeof(fdcan_message_hdr)), data, data_length);
		
		fdcan_mov_w_idx(FDCAN_TX_BUF_PTR(can_num), total_length);
		fdcan_buf_w_unlock(FDCAN_TX_BUF_PTR(can_num));
		return id;
	}
	else return 0;
}

//0xF 9.5
uint8_t data_079[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0xCB, 0x7F, 0xFC, 0x9F, 0x28, 0x76, 0xA5, 0x8C,
                        0xAA, 0x00, 0x06, 0x7F, 0xFC, 0x7B, 0x26, 0x4C,       0x19, 0x7B, 0x26, 0xA0, 0xB9, 0x84, 0xD2, 0xEC,
                        0xB6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6C,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x22, 0x2B, 0x18, 0x35, 0x88, 0x8A, 0x83, 0x66};

//0xF 9.5
uint8_t data_07C[64] = {0x00, 0x00, 0x00, 0x73, 0x60, 0x00, 0x00, 0x10,       0x12, 0x80, 0x5A, 0xFF, 0xFE, 0xB5, 0xB2, 0x86,
                        0x98, 0xFF, 0xFE, 0x00, 0x00, 0x00, 0x64, 0x26,       0x17, 0x01, 0x00, 0x7F, 0xFF, 0x00, 0x02, 0x06,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x89, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06,       0x22, 0x2B, 0xE7, 0x01, 0x08, 0x0A, 0xC0, 0xC7};
//0x8 9.5
uint8_t data_0A1[8] =  {0x84, 0x00, 0x97, 0x00, 0x00, 0x00, 0x00, 0x0A};

//0xF 40
uint8_t data_103[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0xAB, 0x01, 0x6F, 0x00, 0x00, 0x00, 0x1A, 0x96,
                        0xA0, 0x00, 0x00, 0x7A, 0x00, 0x00, 0x00, 0x06,       0x96, 0x00, 0x00, 0x00, 0x10, 0x1E, 0x02, 0x86,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x11, 0x17, 0x9D, 0x0A, 0xAD, 0x02, 0x85, 0x33};

//0xF 20
uint8_t data_120[64] = {0x24, 0x52, 0xA0, 0x40, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x2F, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

//0xF 60
uint8_t data_12B[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0xD0, 0xBC, 0x04, 0x00, 0x7F, 0xE0, 0x00, 0x0D,
                        0x14, 0x79, 0xE0, 0x70, 0x04, 0x00, 0x00, 0x0D,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x2F, 0x00, 0x00, 0x00, 0x00, 0x00,       0x0A, 0xBF, 0x5A, 0x2B, 0x44, 0xA9, 0x86, 0xE6};
//0xF 20
uint8_t data_12D[64] = {0x84, 0x4D, 0xAA, 0x00, 0xA7, 0xEA, 0xEB, 0xE0,       0x1E, 0x2A, 0x0B, 0xFF, 0xFD, 0x00, 0x03, 0x00,
                        0x2F, 0xEB, 0xEB, 0xEB, 0xE0, 0x00, 0x07, 0xE0,       0x84, 0xA8, 0x7F, 0xFF, 0x00, 0x03, 0x90, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x2F, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

//0xF 20
uint8_t data_137[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0xAC, 0x30, 0x00, 0x00, 0x40, 0x10, 0x00, 0x1D,
                        0xA5, 0x80, 0x01, 0x05, 0x53, 0x0F, 0xFE, 0x0D,       0x68, 0x20, 0x00, 0x04, 0x00, 0x00, 0x00, 0x0D,
                        0x58, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x0D,       0x68, 0x20, 0x00, 0x04, 0x00, 0x00, 0x00, 0x0D,
                        0x00, 0x00, 0x2F, 0x00, 0x00, 0x00, 0x00, 0x00,       0x11, 0x1B, 0xAC, 0xDD, 0x51, 0x51, 0xCB, 0x16};



												
//0xF 20
uint8_t data_13B[64] = {0xA6, 0xE0, 0x00, 0xE0, 0x00, 0x00, 0x00, 0xCD,       0x55, 0x00, 0x01, 0x15, 0x00, 0x00, 0x08, 0x0D,
                        0xA7, 0x00, 0x00, 0xC0, 0x00, 0x7F, 0xFF, 0x0D,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0xC3, 0xE0, 0x00, 0xE0, 0x00, 0x00, 0x00, 0xCD,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x11, 0x1B, 0x08, 0x73, 0xD4, 0xDC, 0xC1, 0x69};

												

												
												

//0xF 40
uint8_t data_143[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x20, 0x04, 0x7F, 0xFF, 0x00, 0xB5, 0x00, 0x0D,
                        0xE5, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x0D,       0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0D,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x0A, 0xBB, 0x9F, 0xCF, 0x27, 0x17, 0x15, 0xB6};

//0xF 20
uint8_t data_147[64] = {0x04, 0x02, 0x00, 0x40, 0x00, 0x00, 0x20, 0x21,       0x14, 0x80, 0xA0, 0x05, 0xDC, 0x05, 0xDC, 0xA1,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

//0xF 20
uint8_t data_15B[64] = {0x08, 0x00, 0x00, 0x3E, 0x80, 0x00, 0x00, 0x26,       0x6E, 0x02, 0xFF, 0x6A, 0x00, 0x00, 0x00, 0x06,
                        0x03, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x06,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x9B, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x06,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x0A, 0xBF, 0xD1, 0xCE, 0xA9, 0x81, 0x38, 0x80};

//0x8 20
uint8_t data_165[8] =  {0x27, 0x00, 0x40, 0xC0, 0x00, 0x00, 0x00, 0x0B};		

//0xF 60
uint8_t data_16F[64] = {0x00, 0x80, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,       0xA8, 0x32, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x87,
                        0x91, 0x80, 0x00, 0x00, 0x00, 0x00, 0x11, 0x87,       0x8B, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07,
                        0x2E, 0x80, 0x00, 0x0F, 0x00, 0x00, 0x1F, 0xC7,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x80, 0x20, 0x08, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

//0xF 40
uint8_t data_18B[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0xB8, 0x00, 0x80, 0x12, 0x00, 0x00, 0x00, 0x0D,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x0A, 0xBB, 0xEB, 0xB4, 0xA0, 0x46, 0x0F, 0x51};

//0x8 50
uint8_t data_19B[8] =  {0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00};	

//0xA 50
uint8_t data_19C[16] =  {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0xDD, 0x6D, 0xC5, 0xBA, 0x45, 0x08, 0x1A};	
												
//0xF 100
uint8_t data_19F[64] = {0x00, 0x5D, 0xC3, 0xD0, 0x97, 0x53, 0x00, 0x00,       0x00, 0x5D, 0xC3, 0xD0, 0x97, 0x53, 0x00, 0x00,
                        0x00, 0x5D, 0xC3, 0xD0, 0x97, 0x53, 0x00, 0x00,       0x00, 0x5D, 0xC3, 0xD0, 0x97, 0x53, 0x00, 0x00,
                        0x00, 0x5D, 0xC3, 0xD0, 0x97, 0x53, 0x00, 0x00,       0x00, 0x5D, 0xC3, 0xD0, 0x97, 0x53, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x04, 0x43, 0x09, 0x61, 0x31, 0xEA, 0x92, 0xCF};

//0x8 50
uint8_t data_1ED[8] =  {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};	

//0xA 50
uint8_t data_1EE[16] =  {0x00, 0x50, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};	


//0xF 50
uint8_t data_203[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

//0x8 20
uint8_t data_221[8] =  {0xC8, 0x00, 0x05, 0x80, 0x00, 0x00, 0x00, 0x01};	

//0xF 50
uint8_t data_222[64] = {0x00, 0x00, 0x00, 0x00, 0x01, 0x90, 0xC8, 0x00,       0x00, 0x06, 0x8A, 0x12, 0x54, 0x08, 0x00, 0x00,
                        0x00, 0x1D, 0x32, 0xC8, 0x00, 0x00, 0xC8, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x64, 0x00, 0x00, 0x00, 0x00, 0xC8, 0x00,       0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05,
                        0x63, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05,       0x04, 0x4F, 0xD9, 0x17, 0x03, 0xD7, 0xAF, 0x7E};

//0xF 50
uint8_t data_227[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x71, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05,
                        0x89, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

//0xF 50
uint8_t data_236[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0xAB, 0x00, 0x3A, 0x00, 0x00, 0x08, 0x00, 0x10,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x06, 0xEB, 0xFC, 0x67, 0x11, 0x24, 0x10, 0x72};

//0x8 50
uint8_t data_238[8] =  {0x00, 0x00, 0x01, 0xC0, 0x05, 0x7F, 0x65, 0x00};	

//0xF 100
uint8_t data_23D[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x7D, 0x91, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05,
                        0x9D, 0x02, 0x20, 0x00, 0x00, 0x00, 0x00, 0x05,       0x01, 0x7F, 0xE2, 0x49, 0xFF, 0xFF, 0xFF, 0x05,
                        0x6E, 0x80, 0x08, 0x00, 0x00, 0x00, 0x00, 0x05,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x04, 0x4F, 0xFD, 0xE8, 0x2F, 0xC9, 0x37, 0x55};

//0xF 50
uint8_t data_240[64] = {0x55, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04,       0xFA, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04,
                        0x9F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04,       0xB9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04,
                        0xDC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04,       0x73, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04,
                        0xB4, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

//0xF 50
uint8_t data_243[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

//0x8 20
uint8_t data_245[8] =  {0x46, 0x55, 0xF3, 0x55, 0xCB, 0x22, 0x0C, 0xE6};	

//0xF 100
uint8_t data_24D[64] = {0x00, 0x3F, 0xF0, 0x00, 0x1F, 0xFE, 0x00, 0x00,       0x3E, 0xFE, 0xFE, 0xFC, 0x00, 0x00, 0x00, 0x02,
                        0x56, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x02,       0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x80, 0x00, 0x00,
                        0x16, 0xFF, 0xFF, 0xFF, 0xFE, 0xE0, 0x00, 0x02,       0xCF, 0xFF, 0xFF, 0xC8, 0xC8, 0xFE, 0xA7, 0x02,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

//0x8 50
uint8_t data_26F[8] =  {0x9B, 0x00, 0xFF, 0xE7, 0xFF, 0x00, 0x00, 0x02};	
//0x8 50
uint8_t data_273[8] =  {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};	

												
//0xF 100
uint8_t data_274[64] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0xB4, 0x00,
                        0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
//0xA 50
uint8_t data_27F[16] = {0x31, 0x00, 0x00, 0xB5, 0xFF, 0x00, 0x00, 0x02,       0x04, 0x62, 0xC4, 0xCA, 0x54, 0x35, 0x9D, 0x11};	

//0xF 100
uint8_t data_289[64] = {0x00, 0x00, 0x00, 0x00, 0x7D, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x7D, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x7D, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0xFF, 0xF0, 0xFF, 0xF0, 0xFF, 0xF0, 0x40,
                        0x00, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
//0x8 100
uint8_t data_293[8] =  {0x00, 0x00, 0x14, 0x0A, 0x02, 0xBC, 0x00, 0x00};	
//0x8 50
uint8_t data_295[8] =  {0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

//0xF 100
uint8_t data_298[64] = {0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x04, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x07, 0xF0,
                        0x00, 0xBB, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x02, 0x2B, 0x46, 0x75, 0x25, 0x50, 0x1A, 0xC7};
//0x8 100
uint8_t data_29F[8] =  {0xAB, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09};

//0xE 100
uint8_t data_2A2[48] = {0x00, 0x00, 0x00, 0x89, 0x80, 0x00, 0x00, 0x00,       0x00, 0x4B, 0x00, 0x00, 0x12, 0xC0, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

//0xF 100
uint8_t data_2AB[64] = {0x00, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x70, 0x00, 0x04, 0x7F, 0xFF, 0x00, 0x00, 0x02,
                        0x8D, 0x00, 0x08, 0x00, 0x00, 0x23, 0xFF, 0x02,       0x9D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
                        0x85, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,       0xE0, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,
                        0x00, 0x3C, 0x78, 0x79, 0xE0, 0x00, 0x00, 0x00,       0x02, 0x27, 0x75, 0x95, 0x22, 0xBA, 0x71, 0x91};

												
												
												
												
//0xF 100
uint8_t data_2B4[64] = {0x00, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x70, 0x00, 0x04, 0x7F, 0xFF, 0x00, 0x00, 0x02,
                        0x8D, 0x00, 0x08, 0x00, 0x00, 0x23, 0xFF, 0x02,       0x9D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
                        0x85, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,       0xE0, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,
                        0x00, 0x3C, 0x78, 0x79, 0xE0, 0x00, 0x00, 0x00,       0x02, 0x27, 0x75, 0x95, 0x22, 0xBA, 0x71, 0x91};
//0xF 100
uint8_t data_2B8[64] = {0x00, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x70, 0x00, 0x04, 0x7F, 0xFF, 0x00, 0x00, 0x02,
                        0x8D, 0x00, 0x08, 0x00, 0x00, 0x23, 0xFF, 0x02,       0x9D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
                        0x85, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,       0xE0, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,
                        0x00, 0x3C, 0x78, 0x79, 0xE0, 0x00, 0x00, 0x00,       0x02, 0x27, 0x75, 0x95, 0x22, 0xBA, 0x71, 0x91};

//0xF 100
uint8_t data_2BB[64] = {0x00, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x70, 0x00, 0x04, 0x7F, 0xFF, 0x00, 0x00, 0x02,
                        0x8D, 0x00, 0x08, 0x00, 0x00, 0x23, 0xFF, 0x02,       0x9D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
                        0x85, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,       0xE0, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,
                        0x00, 0x3C, 0x78, 0x79, 0xE0, 0x00, 0x00, 0x00,       0x02, 0x27, 0x75, 0x95, 0x22, 0xBA, 0x71, 0x91};

//0xF 100
uint8_t data_2C3[64] = {0x00, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x70, 0x00, 0x04, 0x7F, 0xFF, 0x00, 0x00, 0x02,
                        0x8D, 0x00, 0x08, 0x00, 0x00, 0x23, 0xFF, 0x02,       0x9D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
                        0x85, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,       0xE0, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,
                        0x00, 0x3C, 0x78, 0x79, 0xE0, 0x00, 0x00, 0x00,       0x02, 0x27, 0x75, 0x95, 0x22, 0xBA, 0x71, 0x91};

//0xF 100
uint8_t data_2CF[64] = {0x00, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x70, 0x00, 0x04, 0x7F, 0xFF, 0x00, 0x00, 0x02,
                        0x8D, 0x00, 0x08, 0x00, 0x00, 0x23, 0xFF, 0x02,       0x9D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
                        0x85, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,       0xE0, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,
                        0x00, 0x3C, 0x78, 0x79, 0xE0, 0x00, 0x00, 0x00,       0x02, 0x27, 0x75, 0x95, 0x22, 0xBA, 0x71, 0x91};

//0xF 100
uint8_t data_2EC[64] = {0x00, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x70, 0x00, 0x04, 0x7F, 0xFF, 0x00, 0x00, 0x02,
                        0x8D, 0x00, 0x08, 0x00, 0x00, 0x23, 0xFF, 0x02,       0x9D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
                        0x85, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,       0xE0, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,
                        0x00, 0x3C, 0x78, 0x79, 0xE0, 0x00, 0x00, 0x00,       0x02, 0x27, 0x75, 0x95, 0x22, 0xBA, 0x71, 0x91};
//0xF 100
uint8_t data_301[64] = {0x00, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,       0x70, 0x00, 0x04, 0x7F, 0xFF, 0x00, 0x00, 0x02,
                        0x8D, 0x00, 0x08, 0x00, 0x00, 0x23, 0xFF, 0x02,       0x9D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
                        0x85, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,       0xE0, 0x50, 0x00, 0x00, 0x50, 0x00, 0x00, 0x02,
                        0x00, 0x3C, 0x78, 0x79, 0xE0, 0x00, 0x00, 0x00,       0x02, 0x27, 0x75, 0x95, 0x22, 0xBA, 0x71, 0x91
};
												
												
// D7 
uint8_t data_D7[8] =  {0x1A, 0x1A, 0x1A, 0x1A, 0x00, 0x1A, 0x1A, 0x00};	











#include "TIM/tim.h"
//#include "Vehicle_models/vehicle_common.h"

				

uint32_t TEST_TRANSMITTER_CNT  = 0x66;
uint32_t TEST_TRANSMITTER_PSC  = 2000;

void setTANK500_CNT(uint16_t _cnt){
	TEST_TRANSMITTER_CNT = _cnt;
}

volatile uint8_t TEST_TANK500_flag = 0;

volatile uint8_t schedule = 0x00;

static void increment_tank500_odo(){
	if(data_137[44] == 0xFF){
		data_137[44] = 0x00;
		if(data_137[43] == 0x08) data_137[43] = 0x04;
		else data_137[43] = data_137[43] + 1;
	}
	else data_137[44] = data_137[44] + 0x01;
	
	
	if(data_137[44 - 16] == 0xFF){
		data_137[44 - 16] = 0x00;
		if(data_137[43 - 16] == 0x08) data_137[43 - 16] = 0x04;
		else data_137[43 - 16] = data_137[43 - 16] + 1;
	}
	else data_137[44 - 16] = data_137[44 - 16] + 0x01;
	
}

static void rnd_change_spd_tank500(){

	if(data_137[41] > 0x40){
		data_137[41] = 0x20;
	}
	if(data_137[42] > 0xF0){
		data_137[41] = data_137[41] + 0x01;
		data_137[42] = 0x00;
	}
	else{
		data_137[42] = data_137[42] + 0x0F;
	}
	
	
	if(data_137[41 - 16] > 0x40){
		data_137[41 - 16] = 0x20;
	}
	if(data_137[42 - 16] > 0xF0){
		data_137[41 - 16] = data_137[41 - 16] + 0x01;
		data_137[42 - 16] = 0x00;
	}
	else{
		data_137[42 - 16] = data_137[42 - 16] + 0x0F;
	}
	
}


void start_stop_TEST_TANK500(){
	if(TEST_TANK500_flag == 0){
		TEST_TANK500_flag = 0xFF;
		startBasicTimer(TEST_TRANSMITTER_PSC, TEST_TRANSMITTER_CNT, TEST_TRANSMITTER_TIM);
		startBasicTimer(TEST_TRANSMITTER_PSC*2, TEST_TRANSMITTER_CNT, TEST_TRANSMITTER_CNT_TIM);
		SIGNAL_LED_A_ON;
		NVIC_EnableIRQ (TIM4_IRQn);
		NVIC_SetPriority(TIM4_IRQn, MAIN_TIMER_IRQ_P);
		NVIC_EnableIRQ (TIM5_IRQn);
		NVIC_SetPriority(TIM5_IRQn, (MAIN_TIMER_IRQ_P + 2));
	}
	else{
		SIGNAL_LED_A_OFF;
		stopBasicTimer(TEST_TRANSMITTER_TIM);
		stopBasicTimer(TEST_TRANSMITTER_CNT_TIM);
		TEST_TANK500_flag = 0;
	}
}



static uint8_t change_counter = 0x00;

extern void TIM4_IRQHandler(void);
void TIM4_IRQHandler(void){
	if(TIM4->SR & TIM_SR_UIF){
		TIM4->SR &= ~TIM_SR_UIF; // Flag down
		stopBasicTimer(TEST_TRANSMITTER_TIM);
		TIM4->CNT = 0;
		schedule = schedule+1;
		
		if(schedule > 0x08) schedule= 0x00;
		switch(schedule){
			case 0x00: send_TANK500_msg(FDCAN1_E, 0x103, 0xF, data_103); break;
			case 0x01: send_TANK500_msg(FDCAN1_E, 0x7C, 0xF, data_07C); break;
			case 0x02: send_TANK500_msg(FDCAN1_E, 0x79, 0xF, data_079); break;
			case 0x03: send_TANK500_st_msg(FDCAN1_E, 0xD7, 0x8, data_D7); break;
			case 0x05: send_TANK500_msg(FDCAN1_E, 0x13B, 0xF, data_13B); break;
			case 0x06: send_TANK500_msg(FDCAN1_E, 0x143, 0xF, data_143); break;
			case 0x04: send_TANK500_msg(FDCAN1_E, 0x137, 0xF, data_137); break;
			case 0x07: send_TANK500_msg(FDCAN1_E, 0x147, 0xF, data_147); break;
			case 0x08: send_TANK500_msg(FDCAN1_E, 0x15B, 0xF, data_15B); break;
			default:  break;
		}
		startBasicTimer(TEST_TRANSMITTER_PSC, TEST_TRANSMITTER_CNT, TEST_TRANSMITTER_TIM);
	}
}


extern void TIM5_IRQHandler(void);
void TIM5_IRQHandler(void){
	if(TIM5->SR & TIM_SR_UIF){
		TIM5->SR &= ~TIM_SR_UIF; // Flag down
		stopBasicTimer(TEST_TRANSMITTER_CNT_TIM);
		TIM5->CNT = 0;
		pauseBasicTimer(TEST_TRANSMITTER_TIM);
		
		if(change_counter == 0x55){
			change_counter = 0x00;
			increment_tank500_odo();
			rnd_change_spd_tank500();
			static const uint8_t dlc = 8;
			static const uint8_t val_1 = 0x01;
			static const uint8_t val_2 = 0x8C;
			
			if(data_137[47] == 0x0E){
				data_137[47] = 0;
			}
			else data_137[47] = data_137[47] + 1;
			
			if(data_137[47 - 16] == 0x0E){
				data_137[47 - 16] = 0;
			}
			else data_137[47 - 16] = data_137[47 - 16] + 1;
			
			
			//data_137[40] = calculateTankCheckSum(val_1, val_2, &data_137[40], dlc);
			//data_137[40 - 16] = calculateTankCheckSum(val_1, val_2, &data_137[40], dlc);
			
			data_D7[4] += 0x04;
			uint32_t sum = 0;
			
			for(uint8_t i=0; i < 7; i++){
				sum+=data_D7[i];
			}	 
			uint8_t crc = (uint8_t)((0 + 0xD7 + 0x8 + (uint8_t)sum) & 0xFF);
			data_D7[7] = crc;
		}
		else change_counter = change_counter + 1;
	
		startBasicTimer(TEST_TRANSMITTER_PSC*2, TEST_TRANSMITTER_CNT, TEST_TRANSMITTER_CNT_TIM);
		resumeBasicTimer(TEST_TRANSMITTER_TIM);
	}
}


#endif


